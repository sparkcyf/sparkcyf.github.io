<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>在 Ubuntu/Debian 配置 Smokeping 并使用 Caddy 作为服务器 | Sparktour's Blog</title><meta name=keywords content><meta name=description content="在 debian/ubuntu 上安装 Smokeping 时, apt 只会给一个用于 apache2 的配置. 并不能直接用于其他的 Web 服务器, 但迫于VPS上的用的 Web 服务器是 Caddy 因此就参考网上的资料整理出了给 Caddy 用的配置方法."><meta name=author content="sparktour"><link rel=canonical href=https://blog.sparktour.me/posts/2020/03/04/smokeping-with-caddy/><link crossorigin=anonymous href=/assets/css/stylesheet.93f625d739f1d6a5c6f20c146bc6a8d26b233492b34b2220c54b12fd46a04ded.css integrity="sha256-k/Yl1znx1qXG8gwUa8ao0msjNJKzSyIgxUsS/UagTe0=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.sparktour.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.sparktour.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.sparktour.me/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.sparktour.me/apple-touch-icon.png><link rel=mask-icon href=https://blog.sparktour.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://blog.sparktour.me/posts/2020/03/04/smokeping-with-caddy/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://blog.sparktour.me/scss/callout.css><link rel=stylesheet href=https://s4.zstatic.net/ajax/libs/disqusjs/3.0.2/styles/disqusjs.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-6EJ4YX1XZ8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6EJ4YX1XZ8")}</script><meta property="og:url" content="https://blog.sparktour.me/posts/2020/03/04/smokeping-with-caddy/"><meta property="og:site_name" content="Sparktour's Blog"><meta property="og:title" content="在 Ubuntu/Debian 配置 Smokeping 并使用 Caddy 作为服务器"><meta property="og:description" content="在 debian/ubuntu 上安装 Smokeping 时, apt 只会给一个用于 apache2 的配置. 并不能直接用于其他的 Web 服务器, 但迫于VPS上的用的 Web 服务器是 Caddy 因此就参考网上的资料整理出了给 Caddy 用的配置方法."><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-03-04T20:00:00+00:00"><meta property="article:modified_time" content="2024-04-18T18:30:45+08:00"><meta property="og:image" content="https://assets.sparktour.me/img/blog/misc/about-bg.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://assets.sparktour.me/img/blog/misc/about-bg.jpg"><meta name=twitter:title content="在 Ubuntu/Debian 配置 Smokeping 并使用 Caddy 作为服务器"><meta name=twitter:description content="在 debian/ubuntu 上安装 Smokeping 时, apt 只会给一个用于 apache2 的配置. 并不能直接用于其他的 Web 服务器, 但迫于VPS上的用的 Web 服务器是 Caddy 因此就参考网上的资料整理出了给 Caddy 用的配置方法."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.sparktour.me/posts/"},{"@type":"ListItem","position":2,"name":"在 Ubuntu/Debian 配置 Smokeping 并使用 Caddy 作为服务器","item":"https://blog.sparktour.me/posts/2020/03/04/smokeping-with-caddy/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"在 Ubuntu/Debian 配置 Smokeping 并使用 Caddy 作为服务器","name":"在 Ubuntu\/Debian 配置 Smokeping 并使用 Caddy 作为服务器","description":"在 debian/ubuntu 上安装 Smokeping 时, apt 只会给一个用于 apache2 的配置. 并不能直接用于其他的 Web 服务器, 但迫于VPS上的用的 Web 服务器是 Caddy 因此就参考网上的资料整理出了给 Caddy 用的配置方法.\n","keywords":[],"articleBody":"在 debian/ubuntu 上安装 Smokeping 时, apt 只会给一个用于 apache2 的配置. 并不能直接用于其他的 Web 服务器, 但迫于VPS上的用的 Web 服务器是 Caddy 因此就参考网上的资料整理出了给 Caddy 用的配置方法.\n首先需要安装 Smokeping ,并且 disable 掉安装时自带的 Apache2.\napt install smokeping systemctl stop apache2 systemctl disable apache2 还需要装一个fcgiwarp来处理到smokeping的请求,并且装完之后将它启动:\napt install fcgiwrap systemctl enable fcgiwrap.socket systemctl start fcgiwrap.socket 这时候应该能在 /var/run 里面看到 fcgiwrap.socket 这个文件了.\nCaddy不需要其他的插件就可以使用.\n之后查看一下smokeping的网页和cgi程序装在了哪里. 在这里它位于 /usr/share/smokeping 里面;图片缓存,js,css在 /usr/share/smokeping/www 里面.\n下面是 Caddy 的配置:\nsmokeping.example.com { root /usr/share/smokeping/www fastcgi / unix:/var/run/fcgiwrap.socket { env SCRIPT_FILENAME /usr/share/smokeping/smokeping.cgi } } smokeping.example.com/js { root /usr/share/smokeping/www/js } smokeping.example.com/css { root /usr/share/smokeping/www/css } smokeping.example.com/cache { root /var/cache/smokeping } smokeping.example.com/smokeping/images { root /usr/share/smokeping/www/images } 需要注意的是, fastcgi 下面对应的文件是 smokeping.cgi 而不是 www 里面的 smokeping.fcgi.dist , 以及图片也需要单独列一个路径,不然到时候可能无法显示监测的图片.\n配置完成 Smokeping 和 Caddy 之后, 可以先用 smokeping --debug 来测试一下smokeping能不能正常运行,如果能正常运行,此时访问 smokeping.example.com 应该就能正常进行网络监测了.\n配置完成之后 参考资料 Caddy Community 上的讨论 Archlinux Wiki 在网上找到的另一份 Caddy 配置,不过这是给 Arch 的,跟 Debian 系的安装路径什么的还不完全一样. ","wordCount":"469","inLanguage":"zh","image":"https://assets.sparktour.me/img/blog/misc/about-bg.jpg","datePublished":"2020-03-04T20:00:00Z","dateModified":"2024-04-18T18:30:45+08:00","author":{"@type":"Person","name":"sparktour"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.sparktour.me/posts/2020/03/04/smokeping-with-caddy/"},"publisher":{"@type":"Organization","name":"Sparktour's Blog","logo":{"@type":"ImageObject","url":"https://blog.sparktour.me/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.sparktour.me/ accesskey=h title="Sparktour's Blog (Alt + H)">Sparktour's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://blog.sparktour.me/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://blog.sparktour.me/archives title=Archive><span>Archive</span></a></li><li><a href=https://blog.sparktour.me/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://blog.sparktour.me/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://blog.sparktour.me/about/ title=About><span>About</span></a></li><li><a href=https://blog.sparktour.me/friends/ title=Friends><span>Friends</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.sparktour.me/>主页</a>&nbsp;»&nbsp;<a href=https://blog.sparktour.me/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">在 Ubuntu/Debian 配置 Smokeping 并使用 Caddy 作为服务器</h1><div class=post-meta><span title='2020-03-04 20:00:00 +0000 UTC'>2020-03-04</span>&nbsp;·&nbsp;<span title='2024-04-18 18:30:45 +0800 +0800'>更新于: 2024-04-18</span>&nbsp;·&nbsp;1 分钟&nbsp;·&nbsp;sparktour</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99 aria-label=参考资料>参考资料</a></li></ul></div></details></div><div class=post-content><p>在 debian/ubuntu 上安装 Smokeping 时, apt 只会给一个用于 apache2 的配置. 并不能直接用于其他的 Web 服务器, 但迫于VPS上的用的 Web 服务器是 Caddy 因此就参考网上的资料整理出了给 Caddy 用的配置方法.</p><p>首先需要安装 Smokeping ,并且 disable 掉安装时自带的 Apache2.</p><pre tabindex=0><code>apt install smokeping
systemctl stop apache2
systemctl disable apache2
</code></pre><p>还需要装一个fcgiwarp来处理到smokeping的请求,并且装完之后将它启动:</p><pre tabindex=0><code>apt install fcgiwrap
systemctl enable fcgiwrap.socket
systemctl start fcgiwrap.socket
</code></pre><p>这时候应该能在 <code>/var/run</code> 里面看到 <code>fcgiwrap.socket</code> 这个文件了.</p><p>Caddy不需要其他的插件就可以使用.</p><p>之后查看一下smokeping的网页和cgi程序装在了哪里. 在这里它位于 <code>/usr/share/smokeping</code> 里面;图片缓存,js,css在 <code>/usr/share/smokeping/www</code> 里面.</p><p>下面是 Caddy 的配置:</p><pre tabindex=0><code>smokeping.example.com {

        root /usr/share/smokeping/www

        fastcgi / unix:/var/run/fcgiwrap.socket {
                env SCRIPT_FILENAME /usr/share/smokeping/smokeping.cgi
        }
}

smokeping.example.com/js {
        root /usr/share/smokeping/www/js
}

smokeping.example.com/css {
        root /usr/share/smokeping/www/css
}

smokeping.example.com/cache {
        root /var/cache/smokeping
}

smokeping.example.com/smokeping/images {
	      root /usr/share/smokeping/www/images
}
</code></pre><p>需要注意的是, fastcgi 下面对应的文件是 <code>smokeping.cgi</code> 而不是 <code>www</code> 里面的 <code>smokeping.fcgi.dist</code> , 以及图片也需要单独列一个路径,不然到时候可能无法显示监测的图片.</p><p>配置完成 Smokeping 和 Caddy 之后, 可以先用 <code>smokeping --debug</code> 来测试一下smokeping能不能正常运行,如果能正常运行,此时访问 <code>smokeping.example.com</code> 应该就能正常进行网络监测了.</p><p><figure><img loading=lazy src=https://i.loli.net/2020/03/04/EmqZ8aOu7FoQd4i.png alt=配置完成之后><figcaption>配置完成之后</figcaption></figure></p><h2 id=参考资料>参考资料<a hidden class=anchor aria-hidden=true href=#参考资料>#</a></h2><ul><li><a href=https://caddy.community/t/smokeping-caddyfile/3560>Caddy Community 上的讨论</a></li><li><a href=https://wiki.archlinux.org/index.php/Smokeping#Caddy>Archlinux Wiki</a></li><li><a href=https://wiki.archlinux.org/index.php/Smokeping#Caddy>在网上找到的另一份 Caddy 配置</a>,不过这是给 Arch 的,跟 Debian 系的安装路径什么的还不完全一样.</li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://blog.sparktour.me/posts/2020/12/20/visit-szmc-l3-maintenance/><span class=title>« 上一页</span><br><span>观摩深圳地铁3号线高架区段维护</span>
</a><a class=next href=https://blog.sparktour.me/posts/2019/09/09/trip-to-border-of-sz-and-hk/><span class=title>下一页 »</span><br><span>马草垄行山——换个角度看深圳</span></a></nav></footer><div class="callout callout-default"><img src=https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg alt="CC BY-NC-SA 4.0" style=width:88px;height:31px><p style=font-size:12px>Licensed Under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noopener>CC BY-NC-SA 4.0</a></p><p style=font-size:12px>Post Link: <a href=https://blog.sparktour.me/posts/2020/03/04/smokeping-with-caddy/ target=_blank rel=noopener>https://blog.sparktour.me/posts/2020/03/04/smokeping-with-caddy/</a></p></div><script src=https://s4.zstatic.net/ajax/libs/disqusjs/3.0.2/disqusjs.es2015.umd.min.js crossorigin=anonymous></script><div id=disqusjs></div><script>const disqusjs=new DisqusJS({shortname:"sparktour",siteName:"",identifier:"",url:"",title:"",api:"https://disqus.com/api/",apikey:"QhJnXpS5igyHkjYQ91XYC4dSAuEJYAEsHX8hjLrRc1HU9AApOHLrqkwwIp2sKOLk",admin:"",adminLabel:""});disqusjs.render(document.getElementById("disqusjs"))</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.sparktour.me/>Sparktour's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>