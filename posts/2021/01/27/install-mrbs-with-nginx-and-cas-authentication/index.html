<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>安装MRBS并配置CAS | Sparktour's Blog</title><meta name=keywords content><meta name=description content="最近帮助院系使用MRBS（Meeting Room Booking System）搭建了一个简单的会议室预约系统，并配置了Apereo CAS登陆。

安装MRBS
前半部分主要参考的是MRBS的官方安装文档。


从 https://sourceforge.net/projects/mrbs/files/ 下载MRBS，同时，需要保证机器上已经安装了nginx, mysql/mariadb, fcgiwrap , php-fpm,  php-xml 和 php-curl。"><meta name=author content="sparktour"><link rel=canonical href=https://blog.sparktour.me/posts/2021/01/27/install-mrbs-with-nginx-and-cas-authentication/><link crossorigin=anonymous href=/assets/css/stylesheet.93f625d739f1d6a5c6f20c146bc6a8d26b233492b34b2220c54b12fd46a04ded.css integrity="sha256-k/Yl1znx1qXG8gwUa8ao0msjNJKzSyIgxUsS/UagTe0=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.sparktour.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.sparktour.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.sparktour.me/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.sparktour.me/apple-touch-icon.png><link rel=mask-icon href=https://blog.sparktour.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://blog.sparktour.me/posts/2021/01/27/install-mrbs-with-nginx-and-cas-authentication/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://blog.sparktour.me/scss/callout.css><link rel=stylesheet href=https://s4.zstatic.net/ajax/libs/disqusjs/3.0.2/styles/disqusjs.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-6EJ4YX1XZ8"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6EJ4YX1XZ8")}</script><meta property="og:url" content="https://blog.sparktour.me/posts/2021/01/27/install-mrbs-with-nginx-and-cas-authentication/"><meta property="og:site_name" content="Sparktour's Blog"><meta property="og:title" content="安装MRBS并配置CAS"><meta property="og:description" content="最近帮助院系使用MRBS（Meeting Room Booking System）搭建了一个简单的会议室预约系统，并配置了Apereo CAS登陆。
安装MRBS 前半部分主要参考的是MRBS的官方安装文档。
从 https://sourceforge.net/projects/mrbs/files/ 下载MRBS，同时，需要保证机器上已经安装了nginx, mysql/mariadb, fcgiwrap , php-fpm, php-xml 和 php-curl。"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-01-27T09:00:00+00:00"><meta property="article:modified_time" content="2024-04-18T18:30:45+08:00"><meta property="og:image" content="https://assets.sparktour.me/img/blog/misc/about-bg.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://assets.sparktour.me/img/blog/misc/about-bg.jpg"><meta name=twitter:title content="安装MRBS并配置CAS"><meta name=twitter:description content="最近帮助院系使用MRBS（Meeting Room Booking System）搭建了一个简单的会议室预约系统，并配置了Apereo CAS登陆。

安装MRBS
前半部分主要参考的是MRBS的官方安装文档。


从 https://sourceforge.net/projects/mrbs/files/ 下载MRBS，同时，需要保证机器上已经安装了nginx, mysql/mariadb, fcgiwrap , php-fpm,  php-xml 和 php-curl。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.sparktour.me/posts/"},{"@type":"ListItem","position":2,"name":"安装MRBS并配置CAS","item":"https://blog.sparktour.me/posts/2021/01/27/install-mrbs-with-nginx-and-cas-authentication/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"安装MRBS并配置CAS","name":"安装MRBS并配置CAS","description":"最近帮助院系使用MRBS（Meeting Room Booking System）搭建了一个简单的会议室预约系统，并配置了Apereo CAS登陆。\n安装MRBS 前半部分主要参考的是MRBS的官方安装文档。\n从 https://sourceforge.net/projects/mrbs/files/ 下载MRBS，同时，需要保证机器上已经安装了nginx, mysql/mariadb, fcgiwrap , php-fpm, php-xml 和 php-curl。\n","keywords":[],"articleBody":"最近帮助院系使用MRBS（Meeting Room Booking System）搭建了一个简单的会议室预约系统，并配置了Apereo CAS登陆。\n安装MRBS 前半部分主要参考的是MRBS的官方安装文档。\n从 https://sourceforge.net/projects/mrbs/files/ 下载MRBS，同时，需要保证机器上已经安装了nginx, mysql/mariadb, fcgiwrap , php-fpm, php-xml 和 php-curl。\n解压MRBS的压缩包。在本文中，MRBS被安装在了/var/www/mrbs/中。\n创建数据库，根据官方文档，需要在MySQL中创建MRBS有关的数据表（PostgreSQL的情况类似，见文档）：\nmysqladmin create mrbs mysql mrbs \u003c tables.my.sql 修改web文件夹中的配置文件config.inc.php：\n\u003c?php // -*-mode: PHP; coding:utf-8;-*- namespace CCSE; //填写MRBS网页的名字 /************************************************************************** * MRBS Configuration File * Configure this file for your site. * You shouldn't have to modify anything outside this file. * * This file has already been populated with the minimum set of configuration * variables that you will need to change to get your system up and running. * If you want to change any of the other settings in systemdefaults.inc.php * or areadefaults.inc.php, then copy the relevant lines into this file * and edit them here. This file will override the default settings and * when you upgrade to a new version of MRBS the config file is preserved. * * NOTE: if you include or require other files from this file, for example * to store your database details in a separate location, then you should * use an absolute and not a relative pathname. **************************************************************************/ /********** * Timezone **********/ // The timezone your meeting rooms run in. It is especially important // to set this if you're using PHP 5 on Linux. In this configuration // if you don't, meetings in a different DST than you are currently // in are offset by the DST offset incorrectly. // // Note that timezones can be set on a per-area basis, so strictly speaking this // setting should be in areadefaults.inc.php, but as it is so important to set // the right timezone it is included here. // // When upgrading an existing installation, this should be set to the // timezone the web server runs in. See the INSTALL document for more information. // // A list of valid timezones can be found at http://php.net/manual/timezones.php // The following line must be uncommented by removing the '//' at the beginning $timezone = \"Asia/Shanghai\"; //设定时区 /******************* * Database settings ******************/ // Which database system: \"pgsql\"=PostgreSQL, \"mysql\"=MySQL $dbsys = \"mysql\"; //设定数据库类型 // Hostname of database server. For pgsql, can use \"\" instead of localhost // to use Unix Domain Sockets instead of TCP/IP. For mysql \"localhost\" // tells the system to use Unix Domain Sockets, and $db_port will be ignored; // if you want to force TCP connection you can use \"127.0.0.1\". $db_host = \"localhost\"; // If you need to use a non standard port for the database connection you // can uncomment the following line and specify the port number $db_port = 3306; //端口 // Database name: $db_database = \"mrbs\"; //数据库名称 // Schema name. This only applies to PostgreSQL and is only necessary if you have more // than one schema in your database and also you are using the same MRBS table names in // multiple schemas. //$db_schema = \"public\"; // Database login user name: $db_login = \"username\"; // Database login password: $db_password = 'password'; //登陆名和密码 // Prefix for table names. This will allow multiple installations where only // one database is available $db_tbl_prefix = \"mrbs_\"; //表前缀 // Set $db_persist to TRUE to use PHP persistent (pooled) database connections. Note // that persistent connections are not recommended unless your system suffers significant // performance problems without them. They can cause problems with transactions and // locks (see http://php.net/manual/en/features.persistent-connections.php) and although // MRBS tries to avoid those problems, it is generally better not to use persistent // connections if you can. $db_persist = FALSE; 配置nginx\nserver { listen 443 ssl http2; server_name mrbs.website.edu; root /var/www/mrbs/web; index index.php access_log /var/log/nginx/mrbs-access.log; error_log /var/log/nginx/mrbs-error.log; ssl_certificate cert.pem; ssl_certificate_key key.pem; location ~* \\.php$ { fastcgi_pass unix:/run/php/php7.4-fpm.sock; #php-fpm的位置需根据实际情况填写 include fastcgi_params; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; fastcgi_param SCRIPT_NAME $fastcgi_script_name; } } 在进行上述的配置之后，应该就可以正常访问MRBS的界面了。如果出现403等错误，可能需要\nchown -R www-data:www-data /var/www/mrbs/ 配置CAS CAS登陆是借助MRBS内置的phpCAS实现的。\n需要在config.inc.php加上以下的配置：\n//CAS $auth['session'] = 'cas'; $auth[\"type\"] = \"cas\"; //$auth['cas']['debug'] = true; //debug模式，如果需要自行开启 $auth[\"admin\"][] = \"admin-username\"; //之后如果从CAS登入这个username，它会被赋予管理员权限 include_once('lib/CAS.php'); $auth['cas']['host']='cas.website.edu'; $auth['cas']['port']= 443; $auth['cas']['context']='/cas'; //这里的路径是Apereo CAS的通用路径，每个机构可能会不一样。 $auth['cas']['ca_cert_path']='/var/www/mrbs/web/lets-encrypt-r3.pem'; //由于机构的CAS使用的证书是LE的，因此这里的证书是lets-encrypt-r3，具体情况需要根据cas服务器的证书具体讨论 配置Attribute（可选） 如果需要让MRBS现实将/var/www/mrbs/web/lib/CAS/Client.php里面的['phpCAS']['user']替换为['phpCAS']['attributes']['name']（根据实际情况修改）\n其他 如果配置CAS后尝试登陆报错，可以在配置文件里面加一行phpCAS::setDebug();，然后可以在/tmp/phpCAS.log里面找到详细的日志信息。\n参考资料 How to setup CAS login using the MRBS 1.7.1 release? （这个配置有问题，建议不要照抄） ","wordCount":"1432","inLanguage":"zh","image":"https://assets.sparktour.me/img/blog/misc/about-bg.jpg","datePublished":"2021-01-27T09:00:00Z","dateModified":"2024-04-18T18:30:45+08:00","author":{"@type":"Person","name":"sparktour"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.sparktour.me/posts/2021/01/27/install-mrbs-with-nginx-and-cas-authentication/"},"publisher":{"@type":"Organization","name":"Sparktour's Blog","logo":{"@type":"ImageObject","url":"https://blog.sparktour.me/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.sparktour.me/ accesskey=h title="Sparktour's Blog (Alt + H)">Sparktour's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://blog.sparktour.me/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://blog.sparktour.me/archives title=Archive><span>Archive</span></a></li><li><a href=https://blog.sparktour.me/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://blog.sparktour.me/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://blog.sparktour.me/about/ title=About><span>About</span></a></li><li><a href=https://blog.sparktour.me/friends/ title=Friends><span>Friends</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.sparktour.me/>主页</a>&nbsp;»&nbsp;<a href=https://blog.sparktour.me/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">安装MRBS并配置CAS</h1><div class=post-meta><span title='2021-01-27 09:00:00 +0000 UTC'>2021-01-27</span>&nbsp;·&nbsp;<span title='2024-04-18 18:30:45 +0800 +0800'>更新于: 2024-04-18</span>&nbsp;·&nbsp;3 分钟&nbsp;·&nbsp;sparktour</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e5%ae%89%e8%a3%85mrbs aria-label=安装MRBS>安装MRBS</a></li><li><a href=#%e9%85%8d%e7%bd%aecas aria-label=配置CAS>配置CAS</a></li><li><a href=#%e9%85%8d%e7%bd%aeattribute%e5%8f%af%e9%80%89 aria-label=配置Attribute（可选）>配置Attribute（可选）</a></li><li><a href=#%e5%85%b6%e4%bb%96 aria-label=其他>其他</a></li><li><a href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99 aria-label=参考资料>参考资料</a></li></ul></div></details></div><div class=post-content><p>最近帮助院系使用<a href=https://mrbs.sourceforge.io/>MRBS</a>（Meeting Room Booking System）搭建了一个简单的会议室预约系统，并配置了Apereo CAS登陆。</p><h2 id=安装mrbs>安装MRBS<a hidden class=anchor aria-hidden=true href=#安装mrbs>#</a></h2><p>前半部分主要参考的是<a href="https://mrbs.sourceforge.io/view_text.php?section=Documentation&amp;file=INSTALL">MRBS的官方安装文档</a>。</p><ol><li><p>从 <a href=https://sourceforge.net/projects/mrbs/files/>https://sourceforge.net/projects/mrbs/files/</a> 下载MRBS，同时，需要保证机器上已经安装了<code>nginx</code>, <code>mysql/mariadb</code>, <code>fcgiwrap </code>, <code>php-fpm</code>, <code>php-xml</code> 和 <code>php-curl</code>。</p></li><li><p>解压MRBS的压缩包。在本文中，MRBS被安装在了<code>/var/www/mrbs/</code>中。</p></li><li><p>创建数据库，根据官方文档，需要在MySQL中创建MRBS有关的数据表（PostgreSQL的情况类似，见文档）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mysqladmin create mrbs
</span></span><span class=line><span class=cl>mysql mrbs &lt; tables.my.sql
</span></span></code></pre></div></li><li><p>修改<code>web</code>文件夹中的配置文件<code>config.inc.php</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span> <span class=c1>// -*-mode: PHP; coding:utf-8;-*-
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>namespace</span> <span class=nx>CCSE</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//填写MRBS网页的名字
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=sd>/**************************************************************************
</span></span></span><span class=line><span class=cl><span class=sd> *   MRBS Configuration File
</span></span></span><span class=line><span class=cl><span class=sd> *   Configure this file for your site.
</span></span></span><span class=line><span class=cl><span class=sd> *   You shouldn&#39;t have to modify anything outside this file.
</span></span></span><span class=line><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=cl><span class=sd> *   This file has already been populated with the minimum set of configuration
</span></span></span><span class=line><span class=cl><span class=sd> *   variables that you will need to change to get your system up and running.
</span></span></span><span class=line><span class=cl><span class=sd> *   If you want to change any of the other settings in systemdefaults.inc.php
</span></span></span><span class=line><span class=cl><span class=sd> *   or areadefaults.inc.php, then copy the relevant lines into this file
</span></span></span><span class=line><span class=cl><span class=sd> *   and edit them here.   This file will override the default settings and
</span></span></span><span class=line><span class=cl><span class=sd> *   when you upgrade to a new version of MRBS the config file is preserved.
</span></span></span><span class=line><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=cl><span class=sd> *   NOTE: if you include or require other files from this file, for example
</span></span></span><span class=line><span class=cl><span class=sd> *   to store your database details in a separate location, then you should
</span></span></span><span class=line><span class=cl><span class=sd> *   use an absolute and not a relative pathname.
</span></span></span><span class=line><span class=cl><span class=sd> **************************************************************************/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/**********
</span></span></span><span class=line><span class=cl><span class=sd> * Timezone
</span></span></span><span class=line><span class=cl><span class=sd> **********/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// The timezone your meeting rooms run in. It is especially important
</span></span></span><span class=line><span class=cl><span class=c1>// to set this if you&#39;re using PHP 5 on Linux. In this configuration
</span></span></span><span class=line><span class=cl><span class=c1>// if you don&#39;t, meetings in a different DST than you are currently
</span></span></span><span class=line><span class=cl><span class=c1>// in are offset by the DST offset incorrectly.
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// Note that timezones can be set on a per-area basis, so strictly speaking this
</span></span></span><span class=line><span class=cl><span class=c1>// setting should be in areadefaults.inc.php, but as it is so important to set
</span></span></span><span class=line><span class=cl><span class=c1>// the right timezone it is included here.
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// When upgrading an existing installation, this should be set to the
</span></span></span><span class=line><span class=cl><span class=c1>// timezone the web server runs in.  See the INSTALL document for more information.
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// A list of valid timezones can be found at http://php.net/manual/timezones.php
</span></span></span><span class=line><span class=cl><span class=c1>// The following line must be uncommented by removing the &#39;//&#39; at the beginning
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$timezone</span> <span class=o>=</span> <span class=s2>&#34;Asia/Shanghai&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//设定时区
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=sd>/*******************
</span></span></span><span class=line><span class=cl><span class=sd> * Database settings
</span></span></span><span class=line><span class=cl><span class=sd> ******************/</span>
</span></span><span class=line><span class=cl><span class=c1>// Which database system: &#34;pgsql&#34;=PostgreSQL, &#34;mysql&#34;=MySQL
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$dbsys</span> <span class=o>=</span> <span class=s2>&#34;mysql&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//设定数据库类型
</span></span></span><span class=line><span class=cl><span class=c1>// Hostname of database server. For pgsql, can use &#34;&#34; instead of localhost
</span></span></span><span class=line><span class=cl><span class=c1>// to use Unix Domain Sockets instead of TCP/IP. For mysql &#34;localhost&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// tells the system to use Unix Domain Sockets, and $db_port will be ignored;
</span></span></span><span class=line><span class=cl><span class=c1>// if you want to force TCP connection you can use &#34;127.0.0.1&#34;.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$db_host</span> <span class=o>=</span> <span class=s2>&#34;localhost&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// If you need to use a non standard port for the database connection you
</span></span></span><span class=line><span class=cl><span class=c1>// can uncomment the following line and specify the port number
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$db_port</span> <span class=o>=</span> <span class=mi>3306</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//端口
</span></span></span><span class=line><span class=cl><span class=c1>// Database name:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$db_database</span> <span class=o>=</span> <span class=s2>&#34;mrbs&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//数据库名称
</span></span></span><span class=line><span class=cl><span class=c1>// Schema name.  This only applies to PostgreSQL and is only necessary if you have more
</span></span></span><span class=line><span class=cl><span class=c1>// than one schema in your database and also you are using the same MRBS table names in
</span></span></span><span class=line><span class=cl><span class=c1>// multiple schemas.
</span></span></span><span class=line><span class=cl><span class=c1>//$db_schema = &#34;public&#34;;
</span></span></span><span class=line><span class=cl><span class=c1>// Database login user name:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$db_login</span> <span class=o>=</span> <span class=s2>&#34;username&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Database login password:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$db_password</span> <span class=o>=</span> <span class=s1>&#39;password&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//登陆名和密码
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Prefix for table names.  This will allow multiple installations where only
</span></span></span><span class=line><span class=cl><span class=c1>// one database is available
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$db_tbl_prefix</span> <span class=o>=</span> <span class=s2>&#34;mrbs_&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//表前缀
</span></span></span><span class=line><span class=cl><span class=c1>// Set $db_persist to TRUE to use PHP persistent (pooled) database connections.  Note
</span></span></span><span class=line><span class=cl><span class=c1>// that persistent connections are not recommended unless your system suffers significant
</span></span></span><span class=line><span class=cl><span class=c1>// performance problems without them.   They can cause problems with transactions and
</span></span></span><span class=line><span class=cl><span class=c1>// locks (see http://php.net/manual/en/features.persistent-connections.php) and although
</span></span></span><span class=line><span class=cl><span class=c1>// MRBS tries to avoid those problems, it is generally better not to use persistent
</span></span></span><span class=line><span class=cl><span class=c1>// connections if you can.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$db_persist</span> <span class=o>=</span> <span class=k>FALSE</span><span class=p>;</span>
</span></span></code></pre></div></li><li><p>配置nginx</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>listen</span> <span class=mi>443</span> <span class=s>ssl</span> <span class=s>http2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>server_name</span> <span class=s>mrbs.website.edu</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>root</span>           <span class=s>/var/www/mrbs/web</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>index</span> <span class=s>index.php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=s>access_log</span> <span class=s>/var/log/nginx/mrbs-access.log</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>error_log</span> <span class=s>/var/log/nginx/mrbs-error.log</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>ssl_certificate</span>     <span class=s>cert.pem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>ssl_certificate_key</span> <span class=s>key.pem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>location</span> <span class=p>~</span><span class=sr>*</span> <span class=s>\.php</span>$ <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>fastcgi_pass</span> <span class=s>unix:/run/php/php7.4-fpm.sock</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#php-fpm的位置需根据实际情况填写
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>include</span>         <span class=s>fastcgi_params</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>fastcgi_param</span>   <span class=s>SCRIPT_FILENAME</span>    <span class=nv>$document_root$fastcgi_script_name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>fastcgi_param</span>   <span class=s>SCRIPT_NAME</span>        <span class=nv>$fastcgi_script_name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></li></ol><p>在进行上述的配置之后，应该就可以正常访问MRBS的界面了。如果出现403等错误，可能需要</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>chown -R www-data:www-data /var/www/mrbs/
</span></span></code></pre></div><h2 id=配置cas>配置CAS<a hidden class=anchor aria-hidden=true href=#配置cas>#</a></h2><p>CAS登陆是借助MRBS内置的<a href=https://github.com/apereo/phpCAS>phpCAS</a>实现的。</p><p>需要在<code>config.inc.php</code>加上以下的配置：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>//CAS
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nv>$auth</span><span class=p>[</span><span class=s1>&#39;session&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;cas&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$auth</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;cas&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//$auth[&#39;cas&#39;][&#39;debug&#39;] = true;
</span></span></span><span class=line><span class=cl><span class=c1>//debug模式，如果需要自行开启
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nv>$auth</span><span class=p>[</span><span class=s2>&#34;admin&#34;</span><span class=p>][]</span> <span class=o>=</span> <span class=s2>&#34;admin-username&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//之后如果从CAS登入这个username，它会被赋予管理员权限
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>include_once</span><span class=p>(</span><span class=s1>&#39;lib/CAS.php&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$auth</span><span class=p>[</span><span class=s1>&#39;cas&#39;</span><span class=p>][</span><span class=s1>&#39;host&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;cas.website.edu&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$auth</span><span class=p>[</span><span class=s1>&#39;cas&#39;</span><span class=p>][</span><span class=s1>&#39;port&#39;</span><span class=p>]</span><span class=o>=</span> <span class=mi>443</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$auth</span><span class=p>[</span><span class=s1>&#39;cas&#39;</span><span class=p>][</span><span class=s1>&#39;context&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;/cas&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//这里的路径是Apereo CAS的通用路径，每个机构可能会不一样。
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nv>$auth</span><span class=p>[</span><span class=s1>&#39;cas&#39;</span><span class=p>][</span><span class=s1>&#39;ca_cert_path&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;/var/www/mrbs/web/lets-encrypt-r3.pem&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//由于机构的CAS使用的证书是LE的，因此这里的证书是lets-encrypt-r3，具体情况需要根据cas服务器的证书具体讨论
</span></span></span></code></pre></div><h2 id=配置attribute可选>配置Attribute（可选）<a hidden class=anchor aria-hidden=true href=#配置attribute可选>#</a></h2><p>如果需要让MRBS现实将<code>/var/www/mrbs/web/lib/CAS/Client.php</code>里面的<code>['phpCAS']['user']</code>替换为<code>['phpCAS']['attributes']['name']</code>（根据实际情况修改）</p><h2 id=其他>其他<a hidden class=anchor aria-hidden=true href=#其他>#</a></h2><p>如果配置CAS后尝试登陆报错，可以在配置文件里面加一行<code>phpCAS::setDebug();</code>，然后可以在<code>/tmp/phpCAS.log</code>里面找到详细的日志信息。</p><h2 id=参考资料>参考资料<a hidden class=anchor aria-hidden=true href=#参考资料>#</a></h2><ul><li><a href=https://sourceforge.net/p/mrbs/support-requests/1533/>How to setup CAS login using the MRBS 1.7.1 release?</a> （这个配置有问题，建议不要照抄）</li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://blog.sparktour.me/posts/2021/04/02/self-host-overleaf/><span class=title>« 上一页</span><br><span>实践自部署Overleaf</span>
</a><a class=next href=https://blog.sparktour.me/posts/2020/12/20/visit-szmc-l3-maintenance/><span class=title>下一页 »</span><br><span>观摩深圳地铁3号线高架区段维护</span></a></nav></footer><div class="callout callout-default"><img src=https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg alt="CC BY-NC-SA 4.0" style=width:88px;height:31px><p style=font-size:12px>Licensed Under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noopener>CC BY-NC-SA 4.0</a></p><p style=font-size:12px>Post Link: <a href=https://blog.sparktour.me/posts/2021/01/27/install-mrbs-with-nginx-and-cas-authentication/ target=_blank rel=noopener>https://blog.sparktour.me/posts/2021/01/27/install-mrbs-with-nginx-and-cas-authentication/</a></p></div><script src=https://s4.zstatic.net/ajax/libs/disqusjs/3.0.2/disqusjs.es2015.umd.min.js crossorigin=anonymous></script><div id=disqusjs></div><script>const disqusjs=new DisqusJS({shortname:"sparktour",siteName:"",identifier:"",url:"",title:"",api:"https://disqus.com/api/",apikey:"QhJnXpS5igyHkjYQ91XYC4dSAuEJYAEsHX8hjLrRc1HU9AApOHLrqkwwIp2sKOLk",admin:"",adminLabel:""});disqusjs.render(document.getElementById("disqusjs"))</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.sparktour.me/>Sparktour's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>