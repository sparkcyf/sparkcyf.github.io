<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Add optional passkey/webauth/OTP login to Keycloak | Sparktour’s Blog</title><meta name=keywords content="tech,keycloak"><meta name=description content="This article describes the process of configuring Keycloak for passwordless login using passkeys, webauthn, and OTP (One-Time Password). Some configurations in this article may require Keycloak 23 or higher to function properly.

Configuring the Authentication Section
In Keycloak&rsquo;s Authentication - Flow menu, duplicate the browser flow.  We&rsquo;ll name the copy browser with optional webauth and otp.

    
    Duplicate Browser Flow


In the new flow, delete browser password form and all steps/flows below it:"><meta name=author content="sparktour"><link rel=canonical href=https://blog.sparktour.me/en/posts/2024/01/24/add-passkey-webauth-otp-support-to-keycloak/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.sparktour.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.sparktour.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.sparktour.me/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.sparktour.me/apple-touch-icon.png><link rel=mask-icon href=https://blog.sparktour.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://blog.sparktour.me/posts/2024/01/24/add-passkey-webauth-otp-support-to-keycloak/><link rel=alternate hreflang=en href=https://blog.sparktour.me/en/posts/2024/01/24/add-passkey-webauth-otp-support-to-keycloak/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://blog.sparktour.me/scss/callout.css><link rel=stylesheet href=https://s4.zstatic.net/ajax/libs/disqusjs/3.0.2/styles/disqusjs.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-6EJ4YX1XZ8"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6EJ4YX1XZ8")}</script><meta property="og:url" content="https://blog.sparktour.me/en/posts/2024/01/24/add-passkey-webauth-otp-support-to-keycloak/"><meta property="og:site_name" content="Sparktour’s Blog"><meta property="og:title" content="Add optional passkey/webauth/OTP login to Keycloak"><meta property="og:description" content="This article describes the process of configuring Keycloak for passwordless login using passkeys, webauthn, and OTP (One-Time Password). Some configurations in this article may require Keycloak 23 or higher to function properly.
Configuring the Authentication Section In Keycloak’s Authentication - Flow menu, duplicate the browser flow. We’ll name the copy browser with optional webauth and otp.
Duplicate Browser Flow In the new flow, delete browser password form and all steps/flows below it:"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-24T12:00:00+00:00"><meta property="article:modified_time" content="2024-07-29T21:32:07+08:00"><meta property="article:tag" content="Tech"><meta property="article:tag" content="Keycloak"><meta property="og:image" content="https://assets.sparktour.me/img/blog/misc/about-bg.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://assets.sparktour.me/img/blog/misc/about-bg.jpg"><meta name=twitter:title content="Add optional passkey/webauth/OTP login to Keycloak"><meta name=twitter:description content="This article describes the process of configuring Keycloak for passwordless login using passkeys, webauthn, and OTP (One-Time Password). Some configurations in this article may require Keycloak 23 or higher to function properly.

Configuring the Authentication Section
In Keycloak&rsquo;s Authentication - Flow menu, duplicate the browser flow.  We&rsquo;ll name the copy browser with optional webauth and otp.

    
    Duplicate Browser Flow


In the new flow, delete browser password form and all steps/flows below it:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Add optional passkey/webauth/OTP login to Keycloak","item":"https://blog.sparktour.me/en/posts/2024/01/24/add-passkey-webauth-otp-support-to-keycloak/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Add optional passkey/webauth/OTP login to Keycloak","name":"Add optional passkey\/webauth\/OTP login to Keycloak","description":"This article describes the process of configuring Keycloak for passwordless login using passkeys, webauthn, and OTP (One-Time Password). Some configurations in this article may require Keycloak 23 or higher to function properly.\nConfiguring the Authentication Section In Keycloak\u0026rsquo;s Authentication - Flow menu, duplicate the browser flow. We\u0026rsquo;ll name the copy browser with optional webauth and otp.\nDuplicate Browser Flow In the new flow, delete browser password form and all steps/flows below it:\n","keywords":["tech","keycloak"],"articleBody":"This article describes the process of configuring Keycloak for passwordless login using passkeys, webauthn, and OTP (One-Time Password). Some configurations in this article may require Keycloak 23 or higher to function properly.\nConfiguring the Authentication Section In Keycloak’s Authentication - Flow menu, duplicate the browser flow. We’ll name the copy browser with optional webauth and otp.\nDuplicate Browser Flow In the new flow, delete browser password form and all steps/flows below it:\ndelete old form First, add a step, select username Form, and set it to required:\nBelow, add a subflow and name it passwordless or password or otp:\nadd-subflow Within the passwordless or password or otp subflow, add three steps: Password Form, WebAuthn Passwordless Authenticator, and OTP Form. These three steps correspond to password authentication, passkey/webauthn authentication, and OTP code (six-digit two-factor authentication) respectively. Set these three steps as alternative, meaning users can choose any one of the three methods to log in.\nThe final result after adding all steps should look like this:\nAuthentication Flow Bind Flow Click on Action in the upper right corner of the flow and bind the newly created flow to the browser flow (browser login):\nbind-flow Enable webauthn in required actions In Authentication-Required actions, enable Webauthn Register Passwordless:\nenable-webauth Using passkey to log in Add a passkey In the Signing in section of the account panel, you’ll see a new Passwordless option. Click Set up Security key to set up your Passkey.\nset-security-key Test Passkey login After entering your account information, you will see the login method interface:\nsign-in-screen Click Security Key to log in using Passkey.\nchoose-method Misc If users are required to set up a passkey/OTP, the Set as default action option in Required Actions needs to be checked.\nReferences https://www.youtube.com/watch?v=PPoaPsfYGwQ ","wordCount":"290","inLanguage":"en","image":"https://assets.sparktour.me/img/blog/misc/about-bg.jpg","datePublished":"2024-01-24T12:00:00Z","dateModified":"2024-07-29T21:32:07+08:00","author":{"@type":"Person","name":"sparktour"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.sparktour.me/en/posts/2024/01/24/add-passkey-webauth-otp-support-to-keycloak/"},"publisher":{"@type":"Organization","name":"Sparktour’s Blog","logo":{"@type":"ImageObject","url":"https://blog.sparktour.me/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.sparktour.me/en/ accesskey=h title="Sparktour’s Blog (Alt + H)">Sparktour’s Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://blog.sparktour.me/ title=中文 aria-label=中文>中文</a></li></ul></div></div><ul id=menu><li><a href=https://blog.sparktour.me/en/archives title=Archive><span>Archive</span></a></li><li><a href=https://blog.sparktour.me/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://blog.sparktour.me/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://blog.sparktour.me/en/about/ title=About><span>About</span></a></li><li><a href=https://blog.sparktour.me/en/friends/ title=Friends><span>Friends</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.sparktour.me/en/>Home</a></div><h1 class="post-title entry-hint-parent">Add optional passkey/webauth/OTP login to Keycloak</h1><div class=post-meta><span title='2024-01-24 12:00:00 +0000 UTC'>2024-01-24</span>&nbsp;·&nbsp;<span title='2024-07-29 21:32:07 +0800 +0800'>LastMod: 2024-07-29</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;sparktour&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://blog.sparktour.me/posts/2024/01/24/add-passkey-webauth-otp-support-to-keycloak/>中文</a></li></ul></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#configuring-the-authentication-section aria-label="Configuring the Authentication Section">Configuring the Authentication Section</a></li><li><a href=#bind-flow aria-label="Bind Flow">Bind Flow</a></li><li><a href=#enable-webauthn-in-required-actions aria-label="Enable webauthn in required actions">Enable webauthn in required actions</a></li><li><a href=#using-passkey-to-log-in aria-label="Using passkey to log in">Using passkey to log in</a><ul><li><a href=#add-a-passkey aria-label="Add a passkey">Add a passkey</a></li><li><a href=#test-passkey-login aria-label="Test Passkey login">Test Passkey login</a></li></ul></li><li><a href=#misc aria-label=Misc>Misc</a></li><li><a href=#references aria-label=References>References</a></li></ul></div></details></div><div class=post-content><p>This article describes the process of configuring Keycloak for passwordless login using passkeys, webauthn, and OTP (One-Time Password). Some configurations in this article may require <a href=https://www.keycloak.org/docs/latest/release_notes/index.html#passkeys-support>Keycloak 23</a> or higher to function properly.</p><h2 id=configuring-the-authentication-section>Configuring the Authentication Section<a hidden class=anchor aria-hidden=true href=#configuring-the-authentication-section>#</a></h2><p>In Keycloak&rsquo;s <code>Authentication - Flow</code> menu, duplicate the browser flow. We&rsquo;ll name the copy <code>browser with optional webauth and otp</code>.</p><p><figure><img loading=lazy src=https://assets.sparktour.me/img/blog/2024/add-passkey-webauth-otp-support-to-keycloak/dup-browser-flow.webp alt="Duplicate Browser Flow"><figcaption>Duplicate Browser Flow</figcaption></figure></p><p>In the new flow, delete <code>browser password form</code> and all steps/flows below it:</p><p><figure><img loading=lazy src=https://assets.sparktour.me/img/blog/2024/add-passkey-webauth-otp-support-to-keycloak/delete-form.webp alt="delete old form"><figcaption>delete old form</figcaption></figure></p><p>First, add a step, select <code>username Form</code>, and set it to required:</p><p><figure><img loading=lazy src=https://assets.sparktour.me/img/blog/2024/add-passkey-webauth-otp-support-to-keycloak/add-step.webp alt><figcaption></figcaption></figure></p><p>Below, add a subflow and name it <code>passwordless or password or otp</code>:</p><p><figure><img loading=lazy src=https://assets.sparktour.me/img/blog/2024/add-passkey-webauth-otp-support-to-keycloak/add-subflow.webp alt=add-subflow><figcaption>add-subflow</figcaption></figure></p><p>Within the <code>passwordless or password or otp</code> subflow, add three steps: <code>Password Form</code>, <code>WebAuthn Passwordless Authenticator</code>, and <code>OTP Form</code>. These three steps correspond to password authentication, passkey/webauthn authentication, and OTP code (six-digit two-factor authentication) respectively. Set these three steps as <code>alternative</code>, meaning users can choose any one of the three methods to log in.</p><p>The final result after adding all steps should look like this:</p><p><figure><img loading=lazy src=https://assets.sparktour.me/img/blog/2024/add-passkey-webauth-otp-support-to-keycloak/auth-flow.webp alt="Authentication Flow"><figcaption>Authentication Flow</figcaption></figure></p><h2 id=bind-flow>Bind Flow<a hidden class=anchor aria-hidden=true href=#bind-flow>#</a></h2><p>Click on <code>Action</code> in the upper right corner of the flow and bind the newly created flow to the browser flow (browser login):</p><p><figure><img loading=lazy src=https://assets.sparktour.me/img/blog/2024/add-passkey-webauth-otp-support-to-keycloak/bind-flow.webp alt=bind-flow><figcaption>bind-flow</figcaption></figure></p><h2 id=enable-webauthn-in-required-actions>Enable webauthn in required actions<a hidden class=anchor aria-hidden=true href=#enable-webauthn-in-required-actions>#</a></h2><p>In <code>Authentication-Required actions</code>, enable <code>Webauthn Register Passwordless</code>:</p><p><figure><img loading=lazy src=https://assets.sparktour.me/img/blog/2024/add-passkey-webauth-otp-support-to-keycloak/enable-webauth.webp alt=enable-webauth><figcaption>enable-webauth</figcaption></figure></p><h2 id=using-passkey-to-log-in>Using passkey to log in<a hidden class=anchor aria-hidden=true href=#using-passkey-to-log-in>#</a></h2><h3 id=add-a-passkey>Add a passkey<a hidden class=anchor aria-hidden=true href=#add-a-passkey>#</a></h3><p>In the Signing in section of the account panel, you&rsquo;ll see a new Passwordless option. Click <code>Set up Security key</code> to set up your Passkey.</p><p><figure><img loading=lazy src=https://assets.sparktour.me/img/blog/2024/add-passkey-webauth-otp-support-to-keycloak/set-security-key.webp alt=set-security-key><figcaption>set-security-key</figcaption></figure></p><h3 id=test-passkey-login>Test Passkey login<a hidden class=anchor aria-hidden=true href=#test-passkey-login>#</a></h3><p>After entering your account information, you will see the login method interface:</p><p><figure><img loading=lazy src=https://assets.sparktour.me/img/blog/2024/add-passkey-webauth-otp-support-to-keycloak/sign-in-screen.webp alt=sign-in-screen><figcaption>sign-in-screen</figcaption></figure></p><p>Click <code>Security Key</code> to log in using Passkey.</p><p><figure><img loading=lazy src=https://assets.sparktour.me/img/blog/2024/add-passkey-webauth-otp-support-to-keycloak/choose-method.webp alt=choose-method><figcaption>choose-method</figcaption></figure></p><h2 id=misc>Misc<a hidden class=anchor aria-hidden=true href=#misc>#</a></h2><p>If users are required to set up a passkey/OTP, the <code>Set as default action</code> option in <code>Required Actions</code> needs to be checked.</p><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ul><li><a href="https://www.youtube.com/watch?v=PPoaPsfYGwQ">https://www.youtube.com/watch?v=PPoaPsfYGwQ</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.sparktour.me/en/tags/tech/>Tech</a></li><li><a href=https://blog.sparktour.me/en/tags/keycloak/>Keycloak</a></li></ul><nav class=paginav><a class=prev href=https://blog.sparktour.me/en/posts/2024/02/05/2024-sha-tau-kok-visit/><span class=title>« Prev</span><br><span>One-day trip to Sha Tau Kok Port Closed Area</span>
</a><a class=next href=https://blog.sparktour.me/en/posts/2023/08/24/mount-nfs-via-rdma-on-mlnx-card/><span class=title>Next »</span><br><span>Mount NFS via RDMA on Mellanox Card</span></a></nav></footer><div class="callout callout-default"><img src=https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-nc-sa.svg alt="CC BY-NC-SA 4.0" style=width:88px;height:31px><p style=font-size:12px>Licensed Under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel=noopener>CC BY-NC-SA 4.0</a></p><p style=font-size:12px>Post Link: <a href=https://blog.sparktour.me/en/posts/2024/01/24/add-passkey-webauth-otp-support-to-keycloak/ target=_blank rel=noopener>https://blog.sparktour.me/en/posts/2024/01/24/add-passkey-webauth-otp-support-to-keycloak/</a></p></div><script src=https://s4.zstatic.net/ajax/libs/disqusjs/3.0.2/disqusjs.es2015.umd.min.js crossorigin=anonymous></script><div id=disqusjs></div><script>const disqusjs=new DisqusJS({shortname:"sparktour",siteName:"",identifier:"",url:"",title:"",api:"https://disqus.com/api/",apikey:"QhJnXpS5igyHkjYQ91XYC4dSAuEJYAEsHX8hjLrRc1HU9AApOHLrqkwwIp2sKOLk",admin:"",adminLabel:""});disqusjs.render(document.getElementById("disqusjs"))</script></article></main><footer class=footer><span>&copy; 2026 <a href=https://blog.sparktour.me/en/>Sparktour’s Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>